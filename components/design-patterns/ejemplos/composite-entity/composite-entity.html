<h1 class="title">Patrón Composite Entity</h1>

<p>El patrón <strong>Composite Entity</strong> es un patrón de la arquitectura Java EE que un objeto de grano grueso que gestiona sus propios objetos dependientes.</p>

<h2 class="subtitle">Propósito</h2>
<p>Gestionar la persistencia de un grafo de objetos como una unidad.</p>

<h2 class="subtitle">Caso de Uso Real: Persistencia de Grafos de Objetos (JPA)</h2>
<p><strong>Contexto:</strong> Tienes un objeto 'Pedido' que contiene una lista de 'Líneas de Pedido' y una 'Dirección de Envío'. Estos objetos están intrínsecamente ligados: una línea de pedido no tiene sentido sin su pedido padre.</p>

<p><strong>El Problema:</strong> Si tienes que guardar manualmente el Pedido, luego iterar por las líneas y guardarlas una a una, el código de persistencia se vuelve repetitivo y propenso a errores transaccionales (guardar el pedido pero fallar en las líneas).</p>

<p><strong>La Solución (Composite Entity):</strong> Tratas el grafo de objetos como una única entidad lógica. El objeto padre (Pedido) es responsable de gestionar el ciclo de vida de sus hijos.
<br>En JPA, esto se consigue con <code>CascadeType.ALL</code> y <code>orphanRemoval=true</code>. Al guardar el padre, el framework persiste automáticamente toda la estructura dependiente.</p>

<h2 class="subtitle">Análisis de la Implementación</h2>

<ul>
    <li>
        <strong>Grano Grueso (Coarse-Grained):</strong> 
        <p>A diferencia de tener muchos objetos de grano fino independientes, la Entidad Compuesta expone el grafo como un solo objeto. Esto reduce el tráfico de red (en sistemas remotos) y simplifica la API de persistencia.</p>
    </li>
    <li>
        <strong>Gestión de Ciclo de Vida:</strong> 
        <p>Los objetos dependientes no tienen identidad fuera del padre. Si borras el Pedido, todas sus líneas deben borrarse. El Composite Entity encapsula esta regla de integridad.</p>
    </li>
</ul>

<h2 class="subtitle">Implementación</h2>

<div class="center-horizontal">
<pre><code class="language-java">
@Entity
class Order {
    @Id private Long id;
    
    @OneToMany(cascade = CascadeType.ALL)
    private List<LineItem> items;
    
    // Al persistir Order, JPA persiste items automáticamente
}
</code></pre>
</div>
<span class="center-horizontal caption">Ejemplo de Composite Entity</span>
