<style>
    .title, .subtitle, strong {
        color: black !important;
    }
</style>
<h1 class="title">Patrón Session Facade</h1>

<p>El patrón <strong>Session Facade</strong> es un patrón de la arquitectura Java EE que proporciona una interfaz de grano grueso para disminuir el tráfico de red entre el cliente y los objetos de negocio.</p>

<h2 class="subtitle">Propósito</h2>
<p>Reducir el número de llamadas remotas y transacciones distribuidas.</p>

<h2 class="subtitle">Caso de Uso Real: Pasarela de Compras (Checkout)</h2>
<p><strong>Contexto:</strong> Completar un pedido implica: 1. Comprobar stock (Inventario), 2. Procesar pago (Banco), 3. Guardar pedido (DB), 4. Enviar email (Notificaciones).</p>

<p><strong>El Problema:</strong> Si el cliente (Frontend o Controlador Web) llama a estos 4 servicios por separado, la latencia de red se multiplica por 4. Y peor, si el pago falla después de reservar stock, ¿quién deshace la reserva? ¿El cliente?</p>

<p><strong>La Solución (Session Facade):</strong> Creas una fachada de servicio (<code class="language-java">OrderFacade</code> o <code class="language-java">CheckoutService</code>) que expone un único método: <code class="language-java">placeOrder()</code>.
<br>Esta fachada coordina las llamadas a los componentes internos en una sola transacción local. El cliente hace una sola llamada remota y recibe un OK o Error atómico.</p>

<h2 class="subtitle">Análisis de la Implementación</h2>

<ul>
    <li>
        <strong>Frontera Transaccional:</strong> 
        <p>El Session Facade suele marcar el inicio y fin de la transacción. Si algo falla dentro del método fachada, se hace Rollback de todos los cambios (stock, pago, DB).</p>
    </li>
    <li>
        <strong>Seguridad:</strong> 
        <p>Actúa como un escudo. Los clientes externos solo ven los métodos expuestos por la fachada, no pueden acceder directamente a los componentes internos sensibles.</p>
    </li>
</ul>

<h2 class="subtitle">Implementación</h2>

<div class="center-horizontal">
<pre><code class="language-java">
@Stateless
public class OrderFacade {
    @EJB private InventoryService inventory;
    @EJB private PaymentService payment;
    @EJB private ShippingService shipping;

    public void placeOrder(Order order) {
        inventory.reserve(order.getItems());
        payment.charge(order.getTotal());
        shipping.schedule(order);
    }
}
</code></pre>
</div>
<span class="center-horizontal caption">Ejemplo de Session Facade</span>
