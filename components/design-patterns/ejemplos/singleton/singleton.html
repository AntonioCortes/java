<style>
    .title, .subtitle, strong {
        color: black !important;
    }
</style>
<h1 class="title">Patrón Singleton</h1>

<p>El patrón <strong>Singleton</strong> es un patrón de diseño creacional que garantiza que una clase tenga una única instancia y proporciona un punto de acceso global a ella.</p>

<h2 class="subtitle">Propósito</h2>
<p>Asegurar que una clase solo tenga una instancia y proporcionar un punto de acceso global a ella.</p>

<h2 class="subtitle">Caso de Uso Real: Pool de Conexiones a Base de Datos</h2>
<p><strong>Contexto:</strong> En una aplicación empresarial, abrir y cerrar conexiones a la base de datos es una operación muy costosa en términos de tiempo y recursos. Además, la base de datos tiene un límite máximo de conexiones simultáneas.</p>

<p><strong>El Problema:</strong> Si cada vez que un usuario hace una petición creamos una nueva conexión (<code class="language-java">new Connection()</code>), podemos saturar rápidamente el servidor de base de datos y tumbar la aplicación. Además, gestionar múltiples instancias de configuración dispersas puede llevar a inconsistencias.</p>

<p><strong>La Solución (Singleton):</strong> Creamos una única instancia encargada de gestionar las conexiones (un Pool).
<br>Cualquier parte de la aplicación que necesite acceder a la base de datos se lo pide a este objeto global. Al haber una sola instancia, podemos controlar centralizadamente cuántas conexiones se abren y reutilizarlas, optimizando los recursos.</p>

<h2 class="subtitle">Implementación (Thread Safe)</h2>

<p>A continuación se muestra una implementación segura para hilos usando "Double-Checked Locking".</p>

<h2 class="subtitle">Análisis de la Implementación</h2>

<ul>
    <li>
        <strong>Constructor Privado:</strong> 
        <p>Al hacer el constructor <code class="language-java">private</code>, impedimos que otras clases usen el operador <code class="language-java">new</code>. Esto garantiza que nadie pueda crear instancias extra por error.</p>
    </li>
    <li>
        <strong>Método Estático <code class="language-java">getInstance()</code>:</strong> 
        <p>Es el único punto de acceso global. Al ser <code class="language-java">static</code>, pertenece a la clase y no a una instancia, permitiendo acceder a la instancia única sin necesidad de tener una referencia previa.</p>
    </li>
</ul>

<div class="center-horizontal">
<pre><code class="language-java">
public class DatabaseConnection {
    // La variable estática que contendrá la única instancia
    private static volatile DatabaseConnection instance;
    
    // Datos de la conexión (ejemplo)
    private String connectionString;

    // Constructor privado para evitar instanciación externa
    private DatabaseConnection() {
        this.connectionString = "jdbc:mysql://localhost:3306/mydb";
        System.out.println("Conexión a base de datos iniciada.");
    }

    // Método público estático para obtener la instancia
    public static DatabaseConnection getInstance() {
        // Primera comprobación (sin bloqueo) para rendimiento
        if (instance == null) {
            // Bloqueo solo si la instancia no existe
            synchronized (DatabaseConnection.class) {
                // Segunda comprobación (dentro del bloqueo)
                if (instance == null) {
                    instance = new DatabaseConnection();
                }
            }
        }
        return instance;
    }

    public void executeQuery(String query) {
        System.out.println("Ejecutando query: " + query);
    }
}
</code></pre>
</div>
<span class="center-horizontal caption">Singleton Thread-Safe con Double-Checked Locking</span>

<br>

<h2 class="subtitle">Ejemplo de Uso</h2>

<div class="center-horizontal">
<pre><code class="language-java">
public class Main {
    public static void main(String[] args) {
        // Intentamos obtener la instancia varias veces
        DatabaseConnection db1 = DatabaseConnection.getInstance();
        DatabaseConnection db2 = DatabaseConnection.getInstance();

        db1.executeQuery("SELECT * FROM users");

        // Comprobamos si son la misma referencia
        if (db1 == db2) {
            System.out.println("Ambas variables apuntan a la misma instancia.");
        } else {
            System.out.println("Son instancias diferentes.");
        }
    }
}
</code></pre>
</div>

<div class="center-horizontal">
<pre><code class="language-java">
Output:
Conexión a base de datos iniciada.
Ejecutando query: SELECT * FROM users
Ambas variables apuntan a la misma instancia.
</code></pre>
</div>
